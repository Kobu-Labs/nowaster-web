{
  "db_name": "PostgreSQL",
  "query": "\n                UPDATE feed_subscription fs\n                SET is_allowed_by_visibility =\n                    (\n                        -- Allow if source user's visibility is public\n                        ((u.visibility_flags & 3) = 3)\n\n                        OR\n\n                        -- Allow if source user's visibility includes friends AND they are friends\n                        (\n                            (u.visibility_flags & 1) = 1\n                            AND EXISTS (\n                                SELECT 1\n                                FROM friend f\n                                WHERE (\n                                          (f.friend_1_id = fs.subscriber_id AND f.friend_2_id = fs.source_id)\n                                       OR (f.friend_2_id = fs.subscriber_id AND f.friend_1_id = fs.source_id)\n                                      )\n                                  AND f.deleted = false\n                            )\n                        )\n\n                        OR\n\n                        -- Allow if subscriber is viewing their own content\n                        (fs.subscriber_id = fs.source_id)\n                    )\n                FROM \"user\" u\n                WHERE fs.source_type = 'user'\n                  AND fs.source_id = $1\n                  AND u.id = fs.source_id;\n\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Text"
      ]
    },
    "nullable": []
  },
  "hash": "d07e74e278b52c787aaa90b4cabd339fbbf8aa85d177920992199e53715394c1"
}
